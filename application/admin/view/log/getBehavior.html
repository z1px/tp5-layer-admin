{layout name="layout:btable" /}

<blockquote class="layui-elem-quote" style="overflow:hidden;">
    <form class="layui-form" style="float:right;">
        <div class="layui-form-item" style="margin:0;">
            <label class="layui-form-label">时间范围</label>
            <div class="layui-input-inline">
                <input type="text" name="begin_date" placeholder="开始日" autocomplete="off" class="layui-input">
            </div>
            <div class="layui-input-inline">
                <input type="text" name="end_date" placeholder="截止日" autocomplete="off" class="layui-input">
            </div>
            <label class="layui-form-label">关键字</label>
            <div class="layui-input-inline">
                <input type="text" name="keyword" placeholder="支持模糊查询.." autocomplete="off" class="layui-input">
            </div>
            <div class="layui-form-mid layui-word-aux" style="padding:0;">
                <button lay-filter="search" class="layui-btn" lay-submit><i class="fa fa-search" aria-hidden="true"></i> 查询</button>
            </div>
        </div>
    </form>
</blockquote>
<div id="content" style="width: 100%;height: 533px;"></div>

<script>
    layui.use(['btable', 'form','layer', 'laydate'], function () {
        var btable = layui.btable(),
            laydate = layui.laydate,
            layerTips = parent.layer === undefined ? layui.layer : parent.layer, //获取父窗口的layer对象
            layer = layui.layer,//获取当前窗口的layer对象;
            form = layui.form();

        btable.set({
            openWait: true,//开启等待框
            elem: '#content',
            url: "{:Url('admin/Log/getBehavior')}", //数据源地址
            type: 'POST', //读取方式
            pageSize: 20,//页大小
            params: {t: new Date().getTime()},//额外的请求参数
            columns: [{ //配置数据列
                fieldName: '编号',
                field: 'id',
                sortable: true
            },  {
                fieldName: '管理员ID',
                field: 'admin_id',
                sortable: true
            },  {
                fieldName: '管理员账号',
                field: 'username',
                sortable: false
            },  {
                fieldName: '行为',
                field: 'title',
                sortable: false
            },  {
                fieldName: '请求地址',
                field: 'url',
                sortable: false,
                format: function (val,obj) {
                    return val?"<a href='"+obj.url+"' target='_blank'>"+obj.url+"</a>（"+obj.type+"）":"";
                }
            },  {
                fieldName: '请求参数',
                field: 'params',
                sortable: false,
                format: function (val,obj) {
                    var html='';
                    if(val){
                        var title='';
                        $.each(obj.params,function (k,v) {
                            if(v){
                                if(k==='icon'){
                                    title+=k+'：<i class=\\\'fa '+v+'\\\'></i><br/>';
                                }else{
                                    title+=k+"："+v+"<br/>";
                                }
                            }
                        });
                        if(title) html+='<a href="javascript:void(0);" id="tips_params_'+obj.id+'" onmouseenter="layer.tips(\''+title+'\',\'#tips_params_'+obj.id+'\',{tips: [2,\'#009688\'],time: 0});" onmouseleave="layer.closeAll(\'tips\')">详情</a>';
                    }
                    return html;
                }
            },  {
                fieldName: '处理结果',
                field: 'result',
                sortable: false,
                format: function (val,obj) {
                    var html='';
                    if(val){
                        var title='';
                        $.each(obj.result,function (k,v) {
                            if(k==='icon'){
                                title+=k+'：<i class=\\\'fa '+v+'\\\'></i><br/>';
                            }else{
                                title+=k+"："+v+"<br/>";
                            }
                        });
                        if(title) html+='<a href="javascript:void(0);" id="tips_result_'+obj.id+'" onmouseenter="layer.tips(\''+title+'\',\'#tips_result_'+obj.id+'\',{tips: [2,\'#009688\'],time: 0});" onmouseleave="layer.closeAll(\'tips\')">详情</a>';
                    }
                    return html;
                }
            },  {
                fieldName: '登录IP',
                field: 'ip',
                sortable: false
            },  {
                fieldName: '登录地区',
                field: 'area',
                sortable: false
            },  {
                fieldName: '登录时间',
                field: 'create_time',
                sortable: false
            }],
            even: true,//隔行变色
            field: 'id', //主键ID
            //skin: 'row',
            checkbox: false,//是否显示多选框
            paged: true, //是否显示分页
            singleSelect: false, //只允许选择一行，checkbox为true生效
            onSuccess: function ($elem) { //$elem当前窗口的jq对象

            }
        });
        btable.render();
        //监听搜索表单的提交事件
        form.on('submit(search)', function (data) {
            console.log(data.field);
            btable.get(data.field);
            return false;
        });

        $(window).on('resize', function (e) {
            var $that = $(this);
            $('#content').height($that.height() - 92);
        }).resize();

        var start = {
            min: "2017-07-01 00:00:00",
            max: laydate.now(),
            istoday: false,
            choose: function(datas){
                end.min = datas; //开始日选好后，重置结束日的最小日期
                end.start = datas //将结束日的初始值设定为开始日
            }
        };

        var end = {
            min: "2017-07-01 00:00:00",
            max: laydate.now(),
            istoday: false,
            choose: function(datas){
                start.max = datas; //结束日选好后，重置开始日的最大日期
            }
        };

        $("input[name=begin_date]").click(function () {
            start.elem = this;
            laydate(start);
        });

        $("input[name=end_date]").click(function () {
            end.elem = this;
            laydate(end);
        });

    });


</script>